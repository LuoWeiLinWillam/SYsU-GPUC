# 语法与语义分析

语法分析与语义分析的目的在于将 Token 流解析为一个语法与语义单元，这节实验的最终的目标是生成一棵语义正确的抽象语法（AST），并生成抽象语法图（ASG）用于下游任务。

## 原理

对于上下文无关文法，实现语法分析的方法一般递归下降法或者 LALR 法，前者利用递归调用子程序的方法来解析语法，而后者根据事先构建的状态机来解析语法。语法分析的过程会检查出程序中的语法错误，例如错误的表达式写法，错误的函数定义等。

单纯的对程序进行语法分析并不能保证程序的语义正确，所以还需要进行语义分析，语义分析一般在 AST 上进行，检查变量的错误类型，检查变量的未定义等问题，对于不同的关注点可以运行多遍的语义检查，也可以在一遍里进行。

此外在语法与语义检查的过程中，需要进行错误的收集和处理，如何尽可能的在一遍运行中给出程序中的错误，也是语法与语义分析实现过程中的难点。

## 实现

为了方便语法与语义分析的实现，我们采用 Bison 和 anltr 来辅助实现。当然我们鼓励学生自主的实现语法与语义分析器。最终我们期望语法与语义分析器给出类似于这样的输出：

```json
{
  "id": "0x1c9f45b1338",
  "kind": "FunctionDecl",
  "loc": {
    "offset": 4,
    "file": ".\\main.cu",
    "line": 1,
    "col": 5,
    "tokLen": 4
  },
  "range": {
    "begin": {
      "offset": 0,
      "col": 1,
      "tokLen": 3
    },
    "end": {
      "offset": 25,
      "line": 3,
      "col": 1,
      "tokLen": 1
    }
  },
  "name": "test",
  "mangledName": "test",
  "type": {
    "qualType": "double ()"
  },
  "inner": [...]
}
```

